---
title: "Retrogradacja Marsa a konflikty"
author: "Tomasz Stąpor"
date: "29 September 2014"
output:
  html_document:
    theme: readable
    toc: yes
---

```{r setup, include=FALSE}
# knitr::opts_chunk$set(cache=TRUE)
```
```{r echo=FALSE}
load("data/124920_1ucdpprioarmedconflictdataset4.2014.rdata") # import DB doucdpConflict
# Zmiana nazwy kolumn do lepszej prezentacji graficznej.
# colnames(ucdpConflict)[1]  <- "ID"
# colnames(ucdpConflict)[11] <- "Int"
# colnames(ucdpConflict)[15]  <- "Prec"
# colnames(ucdpConflict)[17]  <- "Prec2"
# Wybranie określonych kolumn 
data  <- subset(ucdpConflict, select=c(ConflictId,Location,Year,StartDate,StartPrec))
```

Test statystyczny sprawdzający hipotezę astrologiczną głoszącą, że retrogradujący Mars sprzyja konfliktom. Przebadałem 159 początków konfliktów militarnych i sprawdziłem, czy w tych dniach Mars znajdował się w retrogradacji częściej, niż można było się spodziewać na podstawie wyliczeń astronomiczno-statystycznych. Badanie nie potwierdziło prawdziwości hipotezy, że retrogradujący Mars pojawia się częściej podczas powstawania konfliktów militarnych.

## Baza danych 

Badanie oparłem o dane na temat konfliktów militarnych w latach 1946-2013, jakie znalazłem w [UCDP/PRIO Armed Conflict Dataset v.4-2014, 1946 – 2013](http://www.pcr.uu.se/research/ucdp/datasets/ucdp_prio_armed_conflict_dataset/). Baza pochodzi z 2014 roku i jest wydawana przez dwie skandynawskie organizacjie (UCDP i PRIO) zajmujące się badaniem konfliktów na świecie. Dokładny opis bazy danych wraz z wyjaśnieniem poszczególnych zmiennych znajduje się w [Codebook](http://www.pcr.uu.se/digitalAssets/124/124920_1codebook_ucdp_prio-armed-conflict-dataset-v4_2014.pdf).

Z bazy wybrałem jedynie te rekordy, których StartPrec ma wartość 1. Oto pierwsze i ostatnie 3 rekordy z otrzymanych wyników:

```{r echo=FALSE}
data  <- subset(ucdpConflict, select=c(ConflictId,Location,Year,StartDate,StartPrec))
prec1 <- subset(data, StartPrec==1)
prec1
```

Podstawową jednostką w bazie jest konflikt militarny, który posiada unikalny ID. W sumie są odnotowane 254 konfilkty  militarne, których trwanie w kolejnych latach odwzorowane jest w 2134 rekordach. Rekord to kolejny rok, w którym odnotowano conajmniej 25 ofiar śmiertelnych danego konfliktu. Dla lepszego zobrazowania tej struktury posłużę się fragmentem z bazy: 

```{r echo=FALSE}
data  <- subset(ucdpConflict, select=c(ConflictId,Location,Year,StartDate,StartPrec))
prec1 <- subset(data, StartPrec==1)
prec1
```

Konflikt w boliwi

Konflikt o ID 1-78 to konflikt w Etiopii, którego epizody pochłaniające conajmniej 25 ofiar śmiertelnych rozegrały się w latach 1964, 1965, 1966, [...], [1991]. Pierwsza ofiara śmiertelna tego konfliktu pojawiła się — wg _StartDate_ 30.09.1961. Kolumna _StartPrec_ pokazuje dokładność tej daty. 

### Struktura bazy danych

Poniżej uproszczone zestawienie pierwszych 6 z 2134 rekordów. Kolumny Year, StartDate oraz StartPrec są kluczowe dla dalszego badania:

```{r echo=FALSE}

data[c(1:3, 807:809),]# pierwszych 6 wierszy
```

Wyjaśnienie kolumn z bazy danych:

1. ID - Unikalny numer każdego z konfliktu. W powyższym listingu dobrze widać konstrukcję bazy. Konflikt w Boliwi ma ID 1-1. Jeden konflikt może mieć epizody w różnych latach.
2. Location - Miejsce konfliktu. Pojawia się w celach informacyjnych, nie ma znaczenia w badaniu.
3. Year - Rok, w którym odnotowano conajmniej 25 ofiar śmiertelnych danego konfliktu.
4. Level - Poziom konfliktu.
4. StartDate - Data pierwszej ofiary śmiertelnej konfliktu.
5. Prec - Dokładnoć daty z kolumny StartDate. Im wyższa cyfra, tym data dokładniejsza. 1 oznacza do której nie ma żadnych wątpliwości.
6. StartDate2 - Data, w którym epizod konfliktu notowany w danym roku przekroczył 25 ofiar śmiertelnych.
7. Prec2 - Analogicznie, jak Prec, odnosi się do dokładności StartDate2.

### Ilość konfliktów militarnych w latach 1946-2013:

```{r, echo=FALSE}
library(ggplot2)
# load("data/124920_1ucdpprioarmedconflictdataset4.2014.rdata")
fq  <- data.frame(table(ucdpConflict$Year))
ggplot(fq, aes(x=Var1, y=Freq)) +
  geom_line(aes(group=1)) +     # Group all points; otherwise no line will show
  geom_point(size=3) +
  theme(axis.text.x=element_text(angle=90,hjust=1,vjust=0.5))
```

Na wykresie widać, że najwięcej konfliktów, 52 było w 1991 roku. Dla przykładu pik z 1967 roku, wskazuje na 33 konflikty.

Tego typu dane nie nadają się do sprawdzenia hipotezy o retrogradującym Marsie. Czas jego retrogradacji wynosi około 72 dni i dlatego posługiwanie się danymi, których dokładność wynosi 1 rok nie ma tutaj zastosowania. 

### Konflikty ze dokładną datą początku

Do dalszego badania zostały wybrane jedynie te rekordy, których StartPrec jest równe 1, a więc te, do których nie ma wątpliwości, że data w kolumnie StartDate jest dokładna. Pierwsze 6 z 1163 rekordów:

```{r echo=FALSE}
prec1 <- subset(data, StartPrec==1)
# level1 <- subset(data, Level==1)
head(prec1)
# nrow(level1)
```

Następnie dokonałem zliczenia wszystkich dat występujących w kolumnie StartDate:

```{r echo=FALSE}
head(data.frame(table(prec1$StartDate)))
length(table(prec1$StartDate))
```

Wśród 1163 rekordów jest 159 z unikalną wartością StartDate, a więc mam 159 dat początkowych konfliktów. [Cała list w TSV]('')

## Mars w retrogradacji

## Test statystyczy

1. Wartość oczekiwana: Mars w retro przebywa 72 dni na 780 dni = 72/780 = 0,0923 = 9,23% czasu;

2. Wynik badania: 12 na 159 = 0,0755, czyli 7,6%

```{r message=FALSE, echo=FALSE}
library(IPSUR) 
library(HH)
```

```{r}
prop.test(x=12, n=159, p = 72/780, alternative = "greater", conf.level=0.95, correct=FALSE)
```

```{r message=FALSE, echo=FALSE, warning=FALSE}
p <- prop.test(x=12, n=159, p = 72/780, alternative = "greater", conf.level=0.95, correct=FALSE)
plot(p)